<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEX STEP PRO - Avalia√ß√£o Neurocomportamental Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #343a40;
            --light: #f8f9fa;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .screen {
            display: none;
            padding: 40px;
            min-height: 600px;
        }

        .active {
            display: block;
        }

        h1 {
            color: var(--dark);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        h3 {
            color: #555;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .test-card {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .test-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .test-card.completed {
            background: #d4edda;
            border-color: var(--success);
        }

        .test-card .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
        }

        .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .stimulus {
            font-size: 4em;
            text-align: center;
            margin: 40px 0;
            padding: 40px;
            background: var(--light);
            border-radius: 15px;
            border: 3px solid #e9ecef;
            transition: all 0.3s;
        }

        .stroop-stimulus {
            font-size: 3em;
            font-weight: bold;
            padding: 30px;
            margin: 20px 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transition: width 0.5s;
            border-radius: 10px;
        }

        .radar-container {
            width: 100%;
            max-width: 400px;
            margin: 30px auto;
            padding: 20px;
            background: var(--light);
            border-radius: 15px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .instruction-box {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid #2196f3;
        }

        .timer {
            font-size: 1.3em;
            color: var(--dark);
            text-align: center;
            margin: 15px 0;
            font-weight: 600;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .neuro-fact {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .color-key {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela de Boas-Vindas -->
        <div id="welcome-screen" class="screen active">
            <h1>üß† NEX STEP PRO</h1>
            <p style="text-align: center; font-size: 1.2em; color: #666; margin-bottom: 30px;">
                Avalia√ß√£o Neurocomportamental Completa - 7 Testes Cient√≠ficos
            </p>
            
            <div class="instruction-box">
                <h3>üéØ Avalia√ß√£o Completa em 5 Pilares Cognitivos</h3>
                <p>Baseado em evid√™ncias da neuroci√™ncia cognitiva, esta ferramenta avalia seu funcionamento cerebral em tempo real.</p>
                
                <div class="neuro-fact">
                    <strong>üí° Fato Neurocient√≠fico:</strong> Seu c√©rebro processa informa√ß√µes a 120m/s - mais r√°pido que um carro de F1!
                </div>
            </div>

            <div class="test-grid">
                <div class="test-card">
                    <div class="icon">‚ö°</div>
                    <h4>N1 - Aten√ß√£o e Velocidade</h4>
                    <p>‚Ä¢ Tempo de Rea√ß√£o<br>‚Ä¢ Aten√ß√£o Sustentada (CPT)</p>
                </div>
                <div class="test-card">
                    <div class="icon">üí≠</div>
                    <h4>N2 - Controle Executivo</h4>
                    <p>‚Ä¢ Mem√≥ria N-Back<br>‚Ä¢ Controle Inibit√≥rio (Stroop)</p>
                </div>
                <div class="test-card">
                    <div class="icon">üéØ</div>
                    <h4>N3 - Tomada de Decis√£o</h4>
                    <p>‚Ä¢ Iowa Gambling Task<br>‚Ä¢ Regula√ß√£o Emocional</p>
                </div>
                <div class="test-card">
                    <div class="icon">üí¨</div>
                    <h4>N4 - Processamento Verbal</h4>
                    <p>‚Ä¢ Decis√£o Lexical<br>‚Ä¢ Velocidade de Leitura</p>
                </div>
                <div class="test-card">
                    <div class="icon">üìä</div>
                    <h4>N5 - Habilidades Espaciais</h4>
                    <p>‚Ä¢ Rota√ß√£o Mental<br>‚Ä¢ Mem√≥ria Espacial</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="startAssessment()">üöÄ INICIAR AVALIA√á√ÉO COMPLETA</button>
                <p style="color: #666; margin-top: 15px;">Tempo estimado: 20-30 minutos</p>
            </div>
        </div>

        <!-- Tela de Sele√ß√£o de Testes -->
        <div id="test-selection" class="screen">
            <h2>üß™ Bateria de Testes Neurocient√≠ficos</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">
                Complete os 7 testes para gerar seu perfil neurocomportamental completo
            </p>

            <div class="progress-bar">
                <div id="global-progress" class="progress" style="width: 0%"></div>
            </div>
            <div style="text-align: center; color: #666; margin-bottom: 20px;">
                <span id="progress-text">0% Completo</span>
            </div>

            <div class="test-grid">
                <div class="test-card" onclick="startTest('n1-reaction')" id="test-n1-reaction">
                    <div class="icon">‚è±Ô∏è</div>
                    <h4>Tempo de Rea√ß√£o</h4>
                    <p>Velocidade de processamento neural</p>
                    <div class="status">N1 - Aten√ß√£o</div>
                </div>

                <div class="test-card" onclick="startTest('n1-cpt')" id="test-n1-cpt">
                    <div class="icon">üéØ</div>
                    <h4>Aten√ß√£o Sustentada (CPT)</h4>
                    <p>Foco cont√≠nuo e vigil√¢ncia</p>
                    <div class="status">N1 - Aten√ß√£o</div>
                </div>

                <div class="test-card" onclick="startTest('n2-nback')" id="test-n2-nback">
                    <div class="icon">üî¢</div>
                    <h4>Mem√≥ria N-Back</h4>
                    <p>Mem√≥ria operacional e atualiza√ß√£o</p>
                    <div class="status">N2 - Executivo</div>
                </div>

                <div class="test-card" onclick="startTest('n2-stroop')" id="test-n2-stroop">
                    <div class="icon">üé®</div>
                    <h4>Teste de Stroop</h4>
                    <p>Controle inibit√≥rio e interfer√™ncia</p>
                    <div class="status">N2 - Executivo</div>
                </div>

                <div class="test-card" onclick="startTest('n3-gambling')" id="test-n3-gambling">
                    <div class="icon">üé∞</div>
                    <h4>Tomada de Decis√£o</h4>
                    <p>Risco e recompensa emocional</p>
                    <div class="status">N3 - Decis√£o</div>
                </div>

                <div class="test-card" onclick="startTest('n4-lexical')" id="test-n4-lexical">
                    <div class="icon">üìù</div>
                    <h4>Decis√£o Lexical</h4>
                    <p>Processamento verbal e sem√¢ntico</p>
                    <div class="status">N4 - Linguagem</div>
                </div>

                <div class="test-card" onclick="startTest('n5-rotation')" id="test-n5-rotation">
                    <div class="icon">üîÑ</div>
                    <h4>Rota√ß√£o Mental</h4>
                    <p>Habilidades visuoespaciais 3D</p>
                    <div class="status">N5 - Espacial</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="calculateResults()" id="results-btn" disabled>üìä GERAR RELAT√ìRIO COMPLETO</button>
                <p id="completion-message" style="color: #666; margin-top: 10px; display: none;">
                    ‚úÖ Todos os testes completos! Pronto para an√°lise.
                </p>
            </div>
        </div>

        <!-- Container para Todos os Testes -->
        <div id="test-container" class="screen">
            <div id="test-content"></div>
        </div>

        <!-- Tela de Resultados -->
        <div id="results-screen" class="screen">
            <h1>üìà Seu Relat√≥rio NEX STEP PRO</h1>
            
            <div class="result-card">
                <h3>NGES - Neural Global Efficiency Score</h3>
                <div class="score" id="nges-score">-</div>
                <div id="nges-classification" style="font-size: 1.3em; font-weight: 600;"></div>
                <div id="nges-description" style="margin-top: 10px;"></div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <h4>‚ö° N1 - Aten√ß√£o</h4>
                    <div class="score" id="n1-score">-</div>
                    <div id="n1-percentile"></div>
                </div>
                <div class="result-card">
                    <h4>üí≠ N2 - Executivo</h4>
                    <div class="score" id="n2-score">-</div>
                    <div id="n2-percentile"></div>
                </div>
                <div class="result-card">
                    <h4>üéØ N3 - Decis√£o</h4>
                    <div class="score" id="n3-score">-</div>
                    <div id="n3-percentile"></div>
                </div>
                <div class="result-card">
                    <h4>üí¨ N4 - Linguagem</h4>
                    <div class="score" id="n4-score">-</div>
                    <div id="n4-percentile"></div>
                </div>
                <div class="result-card">
                    <h4>üìä N5 - Espacial</h4>
                    <div class="score" id="n5-score">-</div>
                    <div id="n5-percentile"></div>
                </div>
            </div>

            <!-- An√°lise Detalhada -->
            <div id="detailed-analysis" style="margin-top: 40px;">
                <h3>üîç An√°lise Detalhada por Pilar</h3>
                <div id="analysis-content"></div>
            </div>

            <!-- Tabela de Compara√ß√£o -->
            <div style="margin-top: 40px;">
                <h3>üìã Desempenho por Teste</h3>
                <table class="comparison-table" id="test-comparison">
                    <thead>
                        <tr>
                            <th>Teste</th>
                            <th>Escore</th>
                            <th>Classifica√ß√£o</th>
                            <th>Detalhes</th>
                        </tr>
                    </thead>
                    <tbody id="test-comparison-body">
                    </tbody>
                </table>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-success" onclick="downloadPDF()">üì• BAIXAR RELAT√ìRIO COMPLETO</button>
                <button class="btn btn-secondary" onclick="restartAssessment()">üîÑ NOVA AVALIA√á√ÉO</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // DADOS E CONFIGURA√á√ïES
        // =============================================
        let participantData = {
            tests: {},
            scores: {},
            startTime: new Date(),
            demographic: {}
        };

        // =============================================
        // FUN√á√ïES PRINCIPAIS
        // =============================================
        function startAssessment() {
            document.getElementById('welcome-screen').classList.remove('active');
            document.getElementById('test-selection').classList.add('active');
            updateProgress();
        }

        function startTest(testType) {
            document.getElementById('test-selection').classList.remove('active');
            document.getElementById('test-container').classList.add('active');
            
            const testContent = document.getElementById('test-content');
            testContent.innerHTML = '';

            switch(testType) {
                case 'n1-reaction':
                    loadReactionTest();
                    break;
                case 'n1-cpt':
                    loadCPTTest();
                    break;
                case 'n2-nback':
                    loadNBackTest();
                    break;
                case 'n2-stroop':
                    loadStroopTest();
                    break;
                case 'n3-gambling':
                    loadGamblingTest();
                    break;
                case 'n4-lexical':
                    loadLexicalTest();
                    break;
                case 'n5-rotation':
                    loadRotationTest();
                    break;
            }
        }

        // =============================================
        // TESTE N1 - TEMPO DE REA√á√ÉO
        // =============================================
        function loadReactionTest() {
            const testHTML = `
                <h2>‚ö° Teste de Tempo de Rea√ß√£o</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Clique no bot√£o quando a tela ficar VERDE. Responda o mais r√°pido poss√≠vel!</p>
                    <p>üî¨ <em>Este teste mede a velocidade de transmiss√£o neural entre olho e m√£o.</em></p>
                </div>
                <div id="reaction-stimulus" class="stimulus" style="background-color: #dc3545; color: white; cursor: pointer;">
                    üî¥ AGUARDE O VERDE...
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="startReactionTrial()">üé¨ INICIAR TESTE (10 tentativas)</button>
                    <div id="reaction-results" style="text-align: center; margin-top: 20px; font-size: 1.1em;"></div>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
        }

        let reactionTimes = [];
        let reactionStartTime;
        let reactionTrials = 0;
        const maxReactionTrials = 10;

        function startReactionTrial() {
            if (reactionTrials >= maxReactionTrials) {
                finishReactionTest();
                return;
            }

            const stimulus = document.getElementById('reaction-stimulus');
            const results = document.getElementById('reaction-results');
            
            // Prepara√ß√£o
            stimulus.style.backgroundColor = '#dc3545';
            stimulus.textContent = "üî¥ AGUARDE O VERDE...";
            stimulus.onclick = null;

            // Tempo aleat√≥rio antes do verde (1-4 segundos)
            const waitTime = 1000 + Math.random() * 3000;
            
            setTimeout(() => {
                stimulus.style.backgroundColor = '#28a745';
                stimulus.textContent = "üü¢ CLIQUE AGORA!";
                reactionStartTime = Date.now();

                // Registrar clique
                stimulus.onclick = function() {
                    const reactionTime = Date.now() - reactionStartTime;
                    reactionTimes.push(reactionTime);
                    reactionTrials++;
                    
                    results.innerHTML = `
                        <p>‚è±Ô∏è <strong>Tempo:</strong> ${reactionTime}ms</p>
                        <p>üìä <strong>Progresso:</strong> ${reactionTrials}/${maxReactionTrials}</p>
                        <p>üìà <strong>M√©dia atual:</strong> ${calculateAverage(reactionTimes)}ms</p>
                    `;

                    if (reactionTrials < maxReactionTrials) {
                        setTimeout(startReactionTrial, 1000);
                    } else {
                        finishReactionTest();
                    }
                };
            }, waitTime);
        }

        function calculateAverage(times) {
            return Math.round(times.reduce((a, b) => a + b, 0) / times.length);
        }

        function finishReactionTest() {
            const avgTime = calculateAverage(reactionTimes);
            // Converter tempo em score (menor tempo = maior score)
            const score = Math.max(0, 100 - (avgTime / 8));
            
            participantData.tests['n1-reaction'] = {
                averageTime: avgTime,
                trials: reactionTimes.length,
                score: Math.round(score),
                rawData: reactionTimes,
                interpretation: getReactionInterpretation(avgTime)
            };

            finishTest('n1-reaction');
        }

        function getReactionInterpretation(time) {
            if (time < 200) return "Excepcionalmente r√°pido";
            if (time < 280) return "Acima da m√©dia";
            if (time < 350) return "Na m√©dia";
            if (time < 450) return "Abaixo da m√©dia";
            return "Necessita aten√ß√£o";
        }

        // =============================================
        // TESTE N1 - ATEN√á√ÉO SUSTENTADA (CPT)
        // =============================================
        function loadCPTTest() {
            const testHTML = `
                <h2>üéØ Teste de Aten√ß√£o Sustentada (CPT)</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Pressione ESPA√áO apenas quando vir a letra <strong>X</strong> seguida de <strong>A</strong>.</p>
                    <p>‚ö†Ô∏è <em>Ignore outras letras e combina√ß√µes. Teste de 1 minuto.</em></p>
                </div>
                <div id="cpt-stimulus" class="stimulus">-</div>
                <div style="text-align: center;">
                    <p>‚è±Ô∏è <strong>Tempo:</strong> <span id="cpt-timer">01:00</span></p>
                    <p>‚úÖ <strong>Acertos:</strong> <span id="cpt-correct">0</span> | ‚ùå <strong>Erros:</strong> <span id="cpt-errors">0</span></p>
                    <button class="btn" onclick="startCPTTest()">üé¨ INICIAR TESTE</button>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
        }

        let cptSequence = [];
        let cptPosition = 0;
        let cptCorrect = 0;
        let cptErrors = 0;
        let cptTimer;
        let cptTimeLeft = 60;

        function startCPTTest() {
            // Gerar sequ√™ncia de letras com alguns targets (XA)
            cptSequence = generateCPTSequence(60, 0.15);
            cptPosition = 0;
            cptCorrect = 0;
            cptErrors = 0;
            cptTimeLeft = 60;

            document.addEventListener('keydown', handleCPTKey);
            startCPTTimer();
            showNextCPTStimulus();
        }

        function generateCPTSequence(length, targetProbability) {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let sequence = [];
            let lastLetter = '';
            
            for (let i = 0; i < length; i++) {
                if (lastLetter === 'X' && Math.random() < targetProbability) {
                    sequence.push('A'); // Target
                } else {
                    sequence.push(letters[Math.floor(Math.random() * letters.length)]);
                }
                lastLetter = sequence[i];
            }
            return sequence;
        }

        function startCPTTimer() {
            cptTimer = setInterval(() => {
                cptTimeLeft--;
                const minutes = Math.floor(cptTimeLeft / 60);
                const seconds = cptTimeLeft % 60;
                document.getElementById('cpt-timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (cptTimeLeft <= 0) {
                    finishCPTTest();
                }
            }, 1000);
        }

        function showNextCPTStimulus() {
            if (cptPosition >= cptSequence.length || cptTimeLeft <= 0) {
                return;
            }
            
            const stimulus = document.getElementById('cpt-stimulus');
            stimulus.textContent = cptSequence[cptPosition];
            
            setTimeout(() => {
                cptPosition++;
                if (cptPosition < cptSequence.length && cptTimeLeft > 0) {
                    showNextCPTStimulus();
                }
            }, 1000);
        }

        function handleCPTKey(event) {
            if (event.code === 'Space') {
                const isTarget = cptPosition > 0 && 
                               cptSequence[cptPosition - 1] === 'X' && 
                               cptSequence[cptPosition] === 'A';
                
                if (isTarget) {
                    cptCorrect++;
                } else {
                    cptErrors++;
                }

                document.getElementById('cpt-correct').textContent = cptCorrect;
                document.getElementById('cpt-errors').textContent = cptErrors;
            }
        }

        function finishCPTTest() {
            clearInterval(cptTimer);
            document.removeEventListener('keydown', handleCPTKey);
            
            const totalTargets = cptSequence.filter((letter, index) => 
                index > 0 && cptSequence[index-1] === 'X' && letter === 'A'
            ).length;
            
            const accuracy = totalTargets > 0 ? (cptCorrect / totalTargets) : 0;
            const score = accuracy * 100;
            
            participantData.tests['n1-cpt'] = {
                correct: cptCorrect,
                errors: cptErrors,
                totalTargets: totalTargets,
                accuracy: accuracy,
                score: Math.round(score),
                duration: 60 - cptTimeLeft
            };

            finishTest('n1-cpt');
        }

        // =============================================
        // TESTE N2 - N-BACK
        // =============================================
        function loadNBackTest() {
            const testHTML = `
                <h2>üî¢ Teste N-Back</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Pressione ESPA√áO quando a letra atual for igual √† de 2 posi√ß√µes atr√°s.</p>
                    <p>üéØ <em>Teste de mem√≥ria operacional e atualiza√ß√£o mental.</em></p>
                </div>
                <div id="nback-stimulus" class="stimulus">-</div>
                <div style="text-align: center;">
                    <p>‚úÖ <strong>Acertos:</strong> <span id="nback-correct">0</span> | ‚ùå <strong>Erros:</strong> <span id="nback-errors">0</span></p>
                    <p>üìä <strong>Progresso:</strong> <span id="nback-progress">0/20</span></p>
                    <button class="btn" onclick="startNBackTest()">üé¨ INICIAR TESTE</button>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
        }

        let nbackSequence = [];
        let nbackPosition = 0;
        let nbackCorrect = 0;
        let nbackErrors = 0;

        function startNBackTest() {
            // Gerar sequ√™ncia com 30% de matches
            nbackSequence = generateNBackSequence(20, 0.3);
            nbackPosition = 0;
            nbackCorrect = 0;
            nbackErrors = 0;

            document.addEventListener('keydown', handleNBackKey);
            showNextNBackStimulus();
        }

        function generateNBackSequence(length, matchProbability) {
            const letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
            let sequence = [];
            
            for (let i = 0; i < length; i++) {
                if (i >= 2 && Math.random() < matchProbability) {
                    sequence.push(sequence[i - 2]);
                } else {
                    sequence.push(letters[Math.floor(Math.random() * letters.length)]);
                }
            }
            return sequence;
        }

        function showNextNBackStimulus() {
            if (nbackPosition >= nbackSequence.length) {
                finishNBackTest();
                return;
            }
            
            const stimulus = document.getElementById('nback-stimulus');
            stimulus.textContent = nbackSequence[nbackPosition];
            document.getElementById('nback-progress').textContent = `${nbackPosition + 1}/20`;

            setTimeout(() => {
                nbackPosition++;
                showNextNBackStimulus();
            }, 2000);
        }

        function handleNBackKey(event) {
            if (event.code === 'Space') {
                const shouldMatch = nbackPosition >= 2 && 
                                   nbackSequence[nbackPosition] === nbackSequence[nbackPosition - 2];
                
                if (shouldMatch) {
                    nbackCorrect++;
                } else {
                    nbackErrors++;
                }

                document.getElementById('nback-correct').textContent = nbackCorrect;
                document.getElementById('nback-errors').textContent = nbackErrors;
            }
        }

        function finishNBackTest() {
            document.removeEventListener('keydown', handleNBackKey);
            
            const accuracy = nbackCorrect / (nbackSequence.length - 2);
            const score = accuracy * 100;
            
            participantData.tests['n2-nback'] = {
                correct: nbackCorrect,
                errors: nbackErrors,
                totalTrials: nbackSequence.length,
                accuracy: accuracy,
                score: Math.round(score)
            };

            finishTest('n2-nback');
        }

        // =============================================
        // TESTE N2 - STROOP
        // =============================================
        function loadStroopTest() {
            const testHTML = `
                <h2>üé® Teste de Stroop</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Identifique a <strong>COR DA TINTA</strong> da palavra, ignorando o significado.</p>
                    <p>üéØ <em>Use as teclas: R(vermelho), A(azul), V(verde), M(marrom)</em></p>
                    <div class="color-key">
                        <div class="color-item"><div class="color-box" style="background: #dc3545;"></div>Vermelho (R)</div>
                        <div class="color-item"><div class="color-box" style="background: #007bff;"></div>Azul (A)</div>
                        <div class="color-item"><div class="color-box" style="background: #28a745;"></div>Verde (V)</div>
                        <div class="color-item"><div class="color-box" style="background: #8B4513;"></div>Marrom (M)</div>
                    </div>
                </div>
                <div id="stroop-stimulus" class="stroop-stimulus">-</div>
                <div style="text-align: center;">
                    <p>‚úÖ <strong>Acertos:</strong> <span id="stroop-correct">0</span> | ‚ùå <strong>Erros:</strong> <span id="stroop-errors">0</span></p>
                    <p>üìä <strong>Progresso:</strong> <span id="stroop-progress">0/25</span></p>
                    <button class="btn" onclick="startStroopTest()">üé¨ INICIAR TESTE</button>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
        }

        let stroopTrials = [];
        let stroopCurrentTrial = 0;
        let stroopCorrect = 0;
        let stroopErrors = 0;
        let stroopStartTime;

        function startStroopTest() {
            stroopTrials = generateStroopTrials(25);
            stroopCurrentTrial = 0;
            stroopCorrect = 0;
            stroopErrors = 0;

            document.addEventListener('keydown', handleStroopKey);
            showNextStroopTrial();
        }

        function generateStroopTrials(count) {
            const colors = [
                { name: 'VERMELHO', value: '#dc3545', key: 'KeyR' },
                { name: 'AZUL', value: '#007bff', key: 'KeyA' },
                { name: 'VERDE', value: '#28a745', key: 'KeyV' },
                { name: 'MARROM', value: '#8B4513', key: 'KeyM' }
            ];
            
            const colorNames = ['VERMELHO', 'AZUL', 'VERDE', 'MARROM'];
            let trials = [];
            
            for (let i = 0; i < count; i++) {
                const textColor = colors[Math.floor(Math.random() * colors.length)];
                const textWord = colorNames[Math.floor(Math.random() * colorNames.length)];
                
                trials.push({
                    word: textWord,
                    color: textColor,
                    isCongruent: textWord === textColor.name
                });
            }
            return trials;
        }

        function showNextStroopTrial() {
            if (stroopCurrentTrial >= stroopTrials.length) {
                finishStroopTest();
                return;
            }
            
            const trial = stroopTrials[stroopCurrentTrial];
            const stimulus = document.getElementById('stroop-stimulus');
            
            stimulus.textContent = trial.word;
            stimulus.style.color = trial.color.value;
            
            document.getElementById('stroop-progress').textContent = `${stroopCurrentTrial + 1}/25`;
            stroopStartTime = Date.now();
        }

        function handleStroopKey(event) {
            const trial = stroopTrials[stroopCurrentTrial];
            const isCorrect = (event.code === trial.color.key);
            
            if (isCorrect) {
                stroopCorrect++;
            } else {
                stroopErrors++;
            }

            document.getElementById('stroop-correct').textContent = stroopCorrect;
            document.getElementById('stroop-errors').textContent = stroopErrors;
            
            stroopCurrentTrial++;
            showNextStroopTrial();
        }

        function finishStroopTest() {
            document.removeEventListener('keydown', handleStroopKey);
            
            const accuracy = stroopCorrect / stroopTrials.length;
            const score = accuracy * 100;
            
            participantData.tests['n2-stroop'] = {
                correct: stroopCorrect,
                errors: stroopErrors,
                totalTrials: stroopTrials.length,
                accuracy: accuracy,
                score: Math.round(score)
            };

            finishTest('n2-stroop');
        }

        // =============================================
        // TESTE N3 - IOWA GAMBLING
        // =============================================
        function loadGamblingTest() {
            const testHTML = `
                <h2>üé∞ Teste de Tomada de Decis√£o</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Escolha entre os baralhos para maximizar seus ganhos. Alguns baralhos s√£o mais vantajosos que outros.</p>
                    <p>üí° <em>Baralhos A e B: alto risco | Baralhos C e D: baixo risco</em></p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 30px 0;">
                    <button class="btn" onclick="selectDeck('A')" style="background: #dc3545;">Baralho A</button>
                    <button class="btn" onclick="selectDeck('B')" style="background: #fd7e14;">Baralho B</button>
                    <button class="btn" onclick="selectDeck('C')" style="background: #28a745;">Baralho C</button>
                    <button class="btn" onclick="selectDeck('D')" style="background: #20c997;">Baralho D</button>
                </div>
                <div style="text-align: center;">
                    <p style="font-size: 1.5em;">üí∞ <strong>Saldo:</strong> R$ <span id="gambling-balance">2000</span></p>
                    <p>üéØ <strong>Escolha:</strong> <span id="gambling-result">-</span></p>
                    <p>üìä <strong>Escolhas restantes:</strong> <span id="gambling-remaining">40</span></p>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
        }

        let gamblingBalance = 2000;
        let gamblingChoices = [];
        let remainingTrials = 40;

        const decks = {
            'A': { gains: [100, 150], losses: [250, 300, 350] }, // Risco
            'B': { gains: [120, 180], losses: [300, 350, 400] }, // Risco
            'C': { gains: [50, 60], losses: [20, 30, 40] },     // Seguro
            'D': { gains: [40, 50], losses: [10, 20, 25] }      // Seguro
        };

        function selectDeck(deck) {
            if (remainingTrials <= 0) return;
            
            const deckConfig = decks[deck];
            const gain = deckConfig.gains[Math.floor(Math.random() * deckConfig.gains.length)];
            const loss = Math.random() < 0.3 ? deckConfig.losses[Math.floor(Math.random() * deckConfig.losses.length)] : 0;
            
            const net = gain - loss;
            gamblingBalance += net;
            
            gamblingChoices.push({
                deck: deck,
                gain: gain,
                loss: loss,
                net: net,
                trial: 40 - remainingTrials + 1
            });
            
            remainingTrials--;
            
            // Atualizar interface
            document.getElementById('gambling-balance').textContent = gamblingBalance;
            document.getElementById('gambling-result').textContent = `Baralho ${deck}: +R$ ${gain} ${loss > 0 ? `-R$ ${loss}` : ''}`;
            document.getElementById('gambling-remaining').textContent = remainingTrials;
            
            if (remainingTrials <= 0) {
                finishGamblingTest();
            }
        }

        function finishGamblingTest() {
            const advantageousChoices = gamblingChoices.filter(choice => 
                choice.deck === 'C' || choice.deck === 'D'
            ).length;
            
            const advantageRatio = advantageousChoices / gamblingChoices.length;
            const score = advantageRatio * 100;
            
            participantData.tests['n3-gambling'] = {
                finalBalance: gamblingBalance,
                totalChoices: gamblingChoices.length,
                advantageousChoices: advantageousChoices,
                advantageRatio: advantageRatio,
                score: Math.round(score),
                rawData: gamblingChoices
            };

            finishTest('n3-gambling');
        }

        // =============================================
        // TESTE N4 - DECIS√ÉO LEXICAL
        // =============================================
        function loadLexicalTest() {
            const testHTML = `
                <h2>üìù Teste de Decis√£o Lexical</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> Pressione SIM se for uma palavra real, N√ÉO se for uma palavra inventada.</p>
                    <p>‚ö° <em>Responda o mais r√°pido poss√≠vel!</em></p>
                </div>
                <div id="lexical-stimulus" class="stimulus">-</div>
                <div style="text-align: center;">
                    <button class="btn" onclick="lexicalResponse(true)">üëç SIM (Palavra Real)</button>
                    <button class="btn btn-secondary" onclick="lexicalResponse(false)">üëé N√ÉO (Palavra Inventada)</button>
                    <p>üìä <strong>Progresso:</strong> <span id="lexical-progress">0/20</span></p>
                    <p>‚úÖ <strong>Acertos:</strong> <span id="lexical-correct">0</span> | ‚ùå <strong>Erros:</strong> <span id="lexical-errors">0</span></p>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
            
            startLexicalTest();
        }

        let lexicalWords = [
            { word: "CASA", isReal: true }, { word: "PEDRA", isReal: true }, { word: "SOL", isReal: true },
            { word: "BLIMPO", isReal: false }, { word: "TRAPO", isReal: true }, { word: "ZUNIR", isReal: true },
            { word: "FLOBER", isReal: false }, { word: "MESA", isReal: true }, { word: "GATO", isReal: true },
            { word: "PRANTAR", isReal: false }, { word: "LUZ", isReal: true }, { word: "FLOR", isReal: true },
            { word: "STROGO", isReal: false }, { word: "RIO", isReal: true }, { word: "MAR", isReal: true },
            { word: "BLESTO", isReal: false }, { word: "NOITE", isReal: true }, { word: "DIA", isReal: true },
            { word: "FRONGO", isReal: false }, { word: "AMOR", isReal: true }
        ];

        let lexicalPosition = 0;
        let lexicalCorrect = 0;
        let lexicalErrors = 0;

        function startLexicalTest() {
            lexicalPosition = 0;
            lexicalCorrect = 0;
            lexicalErrors = 0;
            // Embaralhar palavras
            lexicalWords.sort(() => Math.random() - 0.5);
            showNextLexicalWord();
        }

        function showNextLexicalWord() {
            if (lexicalPosition >= lexicalWords.length) {
                finishLexicalTest();
                return;
            }
            
            const stimulus = document.getElementById('lexical-stimulus');
            const currentWord = lexicalWords[lexicalPosition];
            stimulus.textContent = currentWord.word;
            
            document.getElementById('lexical-progress').textContent = `${lexicalPosition + 1}/20`;
        }

        function lexicalResponse(response) {
            const currentWord = lexicalWords[lexicalPosition];
            const isCorrect = (response === currentWord.isReal);
            
            if (isCorrect) {
                lexicalCorrect++;
            } else {
                lexicalErrors++;
            }

            document.getElementById('lexical-correct').textContent = lexicalCorrect;
            document.getElementById('lexical-errors').textContent = lexicalErrors;
            
            lexicalPosition++;
            showNextLexicalWord();
        }

        function finishLexicalTest() {
            const accuracy = lexicalCorrect / lexicalWords.length;
            const score = accuracy * 100;
            
            participantData.tests['n4-lexical'] = {
                correct: lexicalCorrect,
                errors: lexicalErrors,
                total: lexicalWords.length,
                accuracy: accuracy,
                score: Math.round(score)
            };

            finishTest('n4-lexical');
        }

        // =============================================
        // TESTE N5 - ROTA√á√ÉO MENTAL
        // =============================================
        function loadRotationTest() {
            const testHTML = `
                <h2>üîÑ Teste de Rota√ß√£o Mental</h2>
                <div class="instruction-box">
                    <p><strong>Instru√ß√µes:</strong> As duas figuras s√£o iguais, apenas rotacionadas? Responda SIM ou N√ÉO.</p>
                    <p>üß† <em>Teste de habilidades visuoespaciais e manipula√ß√£o mental 3D.</em></p>
                </div>
                <div style="display: flex; justify-content: center; gap: 40px; margin: 30px 0;">
                    <div style="font-size: 4em;">‚ñ≤</div>
                    <div style="font-size: 4em;" id="rotation-stimulus">‚ñ≤</div>
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="rotationResponse(true)">üëç SIM (S√£o Iguais)</button>
                    <button class="btn btn-secondary" onclick="rotationResponse(false)">üëé N√ÉO (S√£o Diferentes)</button>
                    <p>üìä <strong>Progresso:</strong> <span id="rotation-progress">0/15</span></p>
                    <p>‚úÖ <strong>Acertos:</strong> <span id="rotation-correct">0</span> | ‚ùå <strong>Erros:</strong> <span id="rotation-errors">0</span></p>
                </div>
            `;
            document.getElementById('test-content').innerHTML = testHTML;
            
            startRotationTest();
        }

        let rotationPairs = [
            { shape1: '‚ñ≤', shape2: '‚ñ≤', rotation: 0, same: true },
            { shape1: '‚ñ†', shape2: '‚ñ†', rotation: 90, same: true },
            { shape1: '‚óè', shape2: '‚ñ≤', rotation: 0, same: false },
            { shape1: '‚óÜ', shape2: '‚óÜ', rotation: 180, same: true },
            { shape1: '‚ñ≤', shape2: '‚ñ†', rotation: 0, same: false },
            { shape1: '‚óè', shape2: '‚óè', rotation: 45, same: true },
            { shape1: '‚óÜ', shape2: '‚ñ≤', rotation: 0, same: false },
            { shape1: '‚ñ†', shape2: '‚óè', rotation: 0, same: false },
            { shape1: '‚ñ≤', shape2: '‚ñ≤', rotation: 120, same: true },
            { shape1: '‚óè', shape2: '‚óÜ', rotation: 0, same: false },
            { shape1: '‚ñ†', shape2: '‚ñ†', rotation: 270, same: true },
            { shape1: '‚óÜ', shape2: '‚óè', rotation: 0, same: false },
            { shape1: '‚ñ≤', shape2: '‚ñ†', rotation: 0, same: false },
            { shape1: '‚óè', shape2: '‚óè', rotation: 90, same: true },
            { shape1: '‚óÜ', shape2: '‚óÜ', rotation: 60, same: true }
        ];

        let rotationPosition = 0;
        let rotationCorrect = 0;
        let rotationErrors = 0;

        function startRotationTest() {
            rotationPosition = 0;
            rotationCorrect = 0;
            rotationErrors = 0;
            // Embaralhar pares
            rotationPairs.sort(() => Math.random() - 0.5);
            showNextRotationPair();
        }

        function showNextRotationPair() {
            if (rotationPosition >= rotationPairs.length) {
                finishRotationTest();
                return;
            }
            
            const pair = rotationPairs[rotationPosition];
            document.getElementById('rotation-stimulus').textContent = pair.shape2;
            document.getElementById('rotation-stimulus').style.transform = `rotate(${pair.rotation}deg)`;
            
            document.getElementById('rotation-progress').textContent = `${rotationPosition + 1}/15`;
        }

        function rotationResponse(response) {
            const pair = rotationPairs[rotationPosition];
            const isCorrect = (response === pair.same);
            
            if (isCorrect) {
                rotationCorrect++;
            } else {
                rotationErrors++;
            }

            document.getElementById('rotation-correct').textContent = rotationCorrect;
            document.getElementById('rotation-errors').textContent = rotationErrors;
            
            rotationPosition++;
            showNextRotationPair();
        }

        function finishRotationTest() {
            const accuracy = rotationCorrect / rotationPairs.length;
            const score = accuracy * 100;
            
            participantData.tests['n5-rotation'] = {
                correct: rotationCorrect,
                errors: rotationErrors,
                total: rotationPairs.length,
                accuracy: accuracy,
                score: Math.round(score)
            };

            finishTest('n5-rotation');
        }

        // =============================================
        // FUN√á√ïES AUXILIARES
        // =============================================
        function finishTest(testType) {
            const testCard = document.getElementById(`test-${testType}`);
            testCard.classList.add('completed');
            testCard.innerHTML += '<div class="badge">‚úÖ</div>';
            
            updateProgress();
            
            document.getElementById('test-container').classList.remove('active');
            document.getElementById('test-selection').classList.add('active');
        }

        function updateProgress() {
            const completedTests = Object.keys(participantData.tests).length;
            const totalTests = 7;
            const progress = (completedTests / totalTests) * 100;
            
            document.getElementById('global-progress').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${Math.round(progress)}% Completo`;
            
            if (completedTests === totalTests) {
                document.getElementById('results-btn').disabled = false;
                document.getElementById('completion-message').style.display = 'block';
            }
        }

        // =============================================
        // C√ÅLCULO DE RESULTADOS
        // =============================================
        function calculateResults() {
            // Calcular escores dos pilares com pesos
            const n1Reaction = participantData.tests['n1-reaction']?.score || 50;
            const n1CPT = participantData.tests['n1-cpt']?.score || 50;
            const n1Score = Math.round((n1Reaction * 0.6 + n1CPT * 0.4));

            const n2NBack = participantData.tests['n2-nback']?.score || 50;
            const n2Stroop = participantData.tests['n2-stroop']?.score || 50;
            const n2Score = Math.round((n2NBack * 0.5 + n2Stroop * 0.5));

            const n3Score = participantData.tests['n3-gambling']?.score || 50;
            const n4Score = participantData.tests['n4-lexical']?.score || 50;
            const n5Score = participantData.tests['n5-rotation']?.score || 50;

            // Calcular NGES (m√©dia geom√©trica)
            const nges = Math.round(Math.pow(n1Score * n2Score * n3Score * n4Score * n5Score, 1/5));

            // Atualizar interface com resultados
            updateResultsInterface(n1Score, n2Score, n3Score, n4Score, n5Score, nges);
            generateDetailedAnalysis(n1Score, n2Score, n3Score, n4Score, n5Score, nges);
            updateTestComparisonTable();

            // Mostrar tela de resultados
            document.getElementById('test-selection').classList.remove('active');
            document.getElementById('results-screen').classList.add('active');
        }

        function updateResultsInterface(n1, n2, n3, n4, n5, nges) {
            document.getElementById('n1-score').textContent = n1;
            document.getElementById('n2-score').textContent = n2;
            document.getElementById('n3-score').textContent = n3;
            document.getElementById('n4-score').textContent = n4;
            document.getElementById('n5-score').textContent = n5;
            document.getElementById('nges-score').textContent = nges;

            // Classifica√ß√£o NGES
            let classification = '';
            let description = '';
            
            if (nges >= 85) {
                classification = 'üéØ OTIMIZADO';
                description = 'Recursos neurais de alto n√≠vel. Excelente para posi√ß√µes de lideran√ßa e ambientes complexos.';
            } else if (nges >= 70) {
                classification = '‚úÖ FUNCIONAL FORTE';
                description = 'Bom funcionamento integrado. Desempenho confi√°vel na maioria das situa√ß√µes.';
            } else if (nges >= 55) {
                classification = '‚ö° FUNCIONAL';
                description = 'Desempenho adequado para demandas rotineiras. Oportunidades de desenvolvimento identificadas.';
            } else if (nges >= 40) {
                classification = '‚ö†Ô∏è VULNER√ÅVEL';
                description = 'Processamento neural ineficiente em algumas √°reas. Beneficia-se de estrat√©gias de otimiza√ß√£o.';
            } else {
                classification = 'üö® DEFICIT√ÅRIO';
                description = 'Comprometimento significativo na efici√™ncia neural. Recomenda-se avalia√ß√£o especializada.';
            }

            document.getElementById('nges-classification').textContent = classification;
            document.getElementById('nges-description').textContent = description;
        }

        function generateDetailedAnalysis(n1, n2, n3, n4, n5, nges) {
            let analysis = '<div style="display: grid; gap: 15px; margin-top: 20px;">';
            
            analysis += `<div style="padding: 15px; background: #e8f5e8; border-radius: 10px;">
                <h4>‚ö° N1 - Aten√ß√£o e Velocidade (${n1})</h4>
                <p>${getN1Analysis(n1)}</p>
            </div>`;
            
            analysis += `<div style="padding: 15px; background: #e3f2fd; border-radius: 10px;">
                <h4>üí≠ N2 - Controle Executivo (${n2})</h4>
                <p>${getN2Analysis(n2)}</p>
            </div>`;
            
            analysis += `<div style="padding: 15px; background: #fff3cd; border-radius: 10px;">
                <h4>üéØ N3 - Tomada de Decis√£o (${n3})</h4>
                <p>${getN3Analysis(n3)}</p>
            </div>`;
            
            analysis += `<div style="padding: 15px; background: #fce4ec; border-radius: 10px;">
                <h4>üí¨ N4 - Processamento Verbal (${n4})</h4>
                <p>${getN4Analysis(n4)}</p>
            </div>`;
            
            analysis += `<div style="padding: 15px; background: #e8eaf6; border-radius: 10px;">
                <h4>üìä N5 - Habilidades Espaciais (${n5})</h4>
                <p>${getN5Analysis(n5)}</p>
            </div>`;
            
            analysis += '</div>';
            
            document.getElementById('analysis-content').innerHTML = analysis;
        }

        function getN1Analysis(score) {
            if (score >= 85) return "Excelente velocidade de processamento e aten√ß√£o sustentada. Ideal para tarefas que exigem foco prolongado.";
            if (score >= 70) return "Boa capacidade atencional. Pode manter o foco na maioria das situa√ß√µes do dia a dia.";
            if (score >= 55) return "Aten√ß√£o adequada para tarefas rotineiras. Pode beneficiar-se de pausas estrat√©gicas.";
            return "Sugere dificuldade em manter a aten√ß√£o sustentada. Recomenda-se ambiente com menos distra√ß√µes.";
        }

        function getN2Analysis(score) {
            if (score >= 85) return "Controle executivo excepcional. Grande capacidade de multitarefa e resolu√ß√£o de problemas complexos.";
            if (score >= 70) return "Bom controle inibit√≥rio e flexibilidade mental. Adapta-se bem a mudan√ßas.";
            if (score >= 55) return "Controle executivo funcional. Pode ter dificuldade com interfer√™ncias simult√¢neas.";
            return "Dificuldade com controle inibit√≥rio. Beneficia-se de abordagens passo a passo.";
        }

        function getN3Analysis(score) {
            if (score >= 85) return "Tomada de decis√£o estrat√©gica excelente. Avalia riscos e benef√≠cios de forma equilibrada.";
            if (score >= 70) return "Boa capacidade de decis√£o. Considera consequ√™ncias de m√©dio prazo.";
            if (score >= 55) return "Decis√µes baseadas mais em recompensas imediatas. Pode se beneficiar de an√°lise mais ponderada.";
            return "Tend√™ncia a decis√µes impulsivas. Recomenda-se pausar antes de escolhas importantes.";
        }

        function getN4Analysis(score) {
            if (score >= 85) return "Processamento verbal r√°pido e eficiente. Vocabul√°rio amplo e acesso lexical √°gil.";
            if (score >= 70) return "Boa flu√™ncia verbal. Compreende e processa linguagem com facilidade.";
            if (score >= 55) return "Processamento verbal adequado. Pode ter dificuldade com termos mais complexos.";
            return "Velocidade de processamento verbal reduzida. Beneficia-se de leitura e expans√£o de vocabul√°rio.";
        }

        function getN5Analysis(score) {
            if (score >= 85) return "Habilidades visuoespaciais excepcionais. Grande capacidade de manipula√ß√£o mental 3D.";
            if (score >= 70) return "Boa percep√ß√£o espacial. Navega e manipula objetos mentais com facilidade.";
            if (score >= 55) return "Habilidades espaciais funcionais. Pode ter dificuldade com rota√ß√µes complexas.";
            return "Dificuldade com tarefas espaciais. Beneficia-se de treino com quebra-cabe√ßas e jogos 3D.";
        }

        function updateTestComparisonTable() {
            const tbody = document.getElementById('test-comparison-body');
            tbody.innerHTML = '';
            
            const tests = [
                { id: 'n1-reaction', name: 'Tempo de Rea√ß√£o', pilar: 'N1' },
                { id: 'n1-cpt', name: 'Aten√ß√£o Sustentada', pilar: 'N1' },
                { id: 'n2-nback', name: 'Mem√≥ria N-Back', pilar: 'N2' },
                { id: 'n2-stroop', name: 'Teste de Stroop', pilar: 'N2' },
                { id: 'n3-gambling', name: 'Tomada de Decis√£o', pilar: 'N3' },
                { id: 'n4-lexical', name: 'Decis√£o Lexical', pilar: 'N4' },
                { id: 'n5-rotation', name: 'Rota√ß√£o Mental', pilar: 'N5' }
            ];
            
            tests.forEach(test => {
                const testData = participantData.tests[test.id];
                if (testData) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${test.name}</strong><br><small>${test.pilar}</small></td>
                        <td>${testData.score}</td>
                        <td>${getScoreClassification(testData.score)}</td>
                        <td>${testData.interpretation || getGenericInterpretation(testData.score)}</td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        function getScoreClassification(score) {
            if (score >= 85) return 'üéØ Otimizado';
            if (score >= 70) return '‚úÖ Forte';
            if (score >= 55) return '‚ö° Funcional';
            if (score >= 40) return '‚ö†Ô∏è Vulner√°vel';
            return 'üö® Deficit√°rio';
        }

        function getGenericInterpretation(score) {
            if (score >= 85) return 'Desempenho excepcional';
            if (score >= 70) return 'Acima da m√©dia';
            if (score >= 55) return 'Na m√©dia';
            if (score >= 40) return 'Abaixo da m√©dia';
            return 'Necessita aten√ß√£o';
        }

        function downloadPDF() {
            alert('üìä Relat√≥rio NEX STEP PRO gerado com sucesso!\n\nEm uma implementa√ß√£o completa, este bot√£o geraria um PDF profissional com todos os resultados e an√°lises.');
        }

        function restartAssessment() {
            participantData = {
                tests: {},
                scores: {},
                startTime: new Date(),
                demographic: {}
            };

            document.querySelectorAll('.test-card').forEach(card => {
                card.classList.remove('completed');
                const badge = card.querySelector('.badge');
                if (badge) badge.remove();
            });

            document.getElementById('results-btn').disabled = true;
            document.getElementById('global-progress').style.width = '0%';
            document.getElementById('progress-text').textContent = '0% Completo';
            document.getElementById('completion-message').style.display = 'none';

            document.getElementById('results-screen').classList.remove('active');
            document.getElementById('welcome-screen').classList.add('active');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß† NEX STEP PRO - Ferramenta Completa Carregada');
        });
    </script>
</body>
</html>
